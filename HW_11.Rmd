---
title: "HW_11"
author: "Shaun Donmoyer"
date: "11/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(kableExtra)
```



**3) Write a loop to extract Cape Grim monthly temperature data (GHCN) for 1985-2019 using rnoaa.**

*Hints:*  

+ Request a token from rnoaa. Make a .Rprofile text file (no extension) containing:  
```options(noaakey="your_noaa_token")``` 
and store it at the top of your project directory.    
+ stationid='GHCND:ASN00091245'  
+ Not all years have data!   

```{r}
install.packages('rnoaa') 
```

```{r}
library(rnoaa)
```

```{r}
options(noaakey="vOhMgIvwqWkcgBBlpYPfHSldYhQiTfbR")
```

```{r}
ncdc(datasetid='GSOM', stationid = 'GHCND:ASN00091245', datatypeid='TAVG', startdate = '1991-01-01', enddate = '1991-12-31', limit = 1000, add_units=TRUE)
```



```{r}
library(rnoaa)

options(noaakey="vOhMgIvwqWkcgBBlpYPfHSldYhQiTfbR")

my_df <- data.frame()

for ( i in seq(1985,2019)){ 
  my.query<-ncdc(datasetid='GSOM', stationid ='GHCND:ASN00091245', datatypeid = 'TAVG', startdate = paste0(i, "-01-01"), enddate = paste0(i, "-12-31"), add_units = TRUE)$data
  
  my_df <- rbind(my_df, my.query)
  
}

```



**4) Calculate the average annual temperature and the number of months used to generate that mean from #3 above (years without data can be excluded).  Report in a table, for example:**




```{r}
library(dplyr)

my_df$date <- substr(my_df$date, 1,4)

count_my_df <- my_df %>%
  group_by(date) %>%
  tally()

```



```{r}
the_sum <- my_df %>%
  group_by(date) %>%
   summarize(Tavg = mean(value))

```


```{r}
new_data <- cbind(count_my_df, the_sum)
final_table <- new_data[,-1]
names(final_table)[names(final_table) == "n"] <- "Months"
names(final_table)[names(final_table) == "date"] <- "Year"
final_table %>%
  kable(digits=3) %>%
  kable_styling()

```